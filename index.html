<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Heart Bound</title>
<style>
body {margin:0; overflow:hidden; font-family:Arial,sans-serif; background:#111;}
canvas {display:block; margin:auto;}

/* Menu */
#menu {
  position:absolute; inset:0;
  background:#111;
  color:white;
  display:flex; flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  padding-top:40px;
}
#menu h1 {font-size:70px; margin-bottom:60px; text-align:center;}
#menuTopLeft {
  position:absolute; top:20px; left:20px;
  display:flex; flex-direction:column;
  align-items:flex-start;
}
#highScore {font-size:18px; margin-bottom:10px;}
button {margin-bottom:10px; font-size:18px; padding:8px 16px; cursor:pointer;}
#menuHeart {
  width:150px; height:150px;
  background:red; transform:rotate(-45deg);
  position:relative; margin-bottom:20px;
}
#menuHeart::before, #menuHeart::after {
  content:""; position:absolute; width:150px; height:150px;
  background:red; border-radius:50%;
}
#menuHeart::before {top:-75px;}
#menuHeart::after {left:75px;}
#playBtn {width:120px; height:60px; background:green; color:white; font-weight:bold; font-size:24px; border:none; cursor:pointer; border-radius:10px;}
#rulesDiv {
  display:none; position:absolute; inset:0; background:#222; color:#fff;
  padding:20px; overflow:auto;
}
#rulesDiv h2 {margin-top:0;}
#closeRules {margin-top:20px; padding:10px 20px; cursor:pointer;}

/* Footer */
#footer {position:absolute; bottom:10px; left:10px; color:#fff; font-size:16px;}
#pauseBtn {position:absolute; top:10px; right:10px; padding:10px 20px; font-size:18px; cursor:pointer;}
#menuBtn {position:absolute; top:60px; right:10px; padding:10px 20px; font-size:18px; cursor:pointer;}
#retryBtn {display:none; position:absolute; left:50%; top:260px; transform:translateX(-50%); padding:15px 30px; font-size:22px; background:red; color:white; border:none; cursor:pointer; border-radius:10px;}
</style>
</head>
<body>

<div id="menu">
  <h1>HEART BOUND</h1>
  <div id="menuTopLeft">
    <div id="highScore">High Score: 0</div>
    <button id="rulesBtn">Rules</button>
  </div>
  <div id="menuHeart"></div>
  <div>
    <button class="difficultyBtn" data-diff="easy">Easy</button>
    <button class="difficultyBtn" data-diff="medium">Medium</button>
    <button class="difficultyBtn" data-diff="hard">Hard</button>
  </div>
  <button id="playBtn">PLAY</button>
</div>

<div id="rulesDiv">
  <h2>How to Play</h2>
  <p>Jump over the blocks by pressing SPACE.</p>
  <p>Collect the bubble (+50 points) by jumping into it.</p>
  <p>Each block gives +100 points. Avoid hitting blocks! You have 3 lives.</p>
  <p>Difficulty changes block speed: Easy, Medium, Hard.</p>
  <p>Pause the game using the Pause button. Retry appears on game over.</p>
  <button id="closeRules">Close</button>
</div>

<div id="footer">Created by Keagan Unsworth</div>
<button id="pauseBtn">Pause</button>
<button id="menuBtn">Main Menu</button>
<button id="retryBtn">Retry</button>

<canvas id="game" width="900" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// Game state
let gameRunning=false, score=0, lives=3, highScore=localStorage.getItem('heartBoundHigh') || 0;
let paused=false, difficulty="medium";
let fireworks=[];

// Player
const player = {x:120, y:0, vy:0, jumping:false, width:10, height:40};

// Obstacle
const obstacle = {x:900, y:0, w:50, h:40, speed:5, passed:false};

// Bubble
const bubble = {x:1400, y:260, r:18, collected:false};

// Menu & controls
const menu = document.getElementById("menu");
const playBtn = document.getElementById("playBtn");
const rulesBtn = document.getElementById("rulesBtn");
const rulesDiv = document.getElementById("rulesDiv");
const closeRules = document.getElementById("closeRules");
const highScoreDiv = document.getElementById("highScore");
const menuHeart = document.getElementById("menuHeart");
const pauseBtn = document.getElementById("pauseBtn");
const menuBtn = document.getElementById("menuBtn");
const retryBtn = document.getElementById("retryBtn");
const diffButtons = document.querySelectorAll(".difficultyBtn");

highScoreDiv.innerText = "High Score: " + highScore;

// Difficulty selection
diffButtons.forEach(btn=>{
  btn.addEventListener("click",()=>{
    difficulty = btn.dataset.diff;
    alert("Difficulty set to " + difficulty);
  });
});

playBtn.addEventListener("click", startGame);
rulesBtn.addEventListener("click", ()=>rulesDiv.style.display="block");
closeRules.addEventListener("click", ()=>rulesDiv.style.display="none");
pauseBtn.addEventListener("click",()=>{paused=!paused; pauseBtn.innerText=paused?"Resume":"Pause"; if(!paused) loop();});
menuBtn.addEventListener("click", ()=>{
  gameRunning=false;
  paused=false;
  retryBtn.style.display="none";
  menu.style.display="flex";
});
retryBtn.addEventListener("click", ()=>startGame());

// Controls
document.addEventListener("keydown", e=>{
  if(e.code==="Space" && !player.jumping && !paused){ player.vy=-14; player.jumping=true; }
});

// Menu heart animation
let heartScale=1, heartGrowing=true;
function animateHeart(){
  if(!menu.style.display || menu.style.display=="none") return;
  heartScale += heartGrowing?0.01:-0.01;
  if(heartScale>=1.2) heartGrowing=false;
  if(heartScale<=0.9) heartGrowing=true;
  menuHeart.style.transform = `rotate(-45deg) scale(${heartScale})`;
  requestAnimationFrame(animateHeart);
}
animateHeart();

// Start game
function startGame(){
  menu.style.display="none";
  retryBtn.style.display="none";
  gameRunning=true; paused=false; pauseBtn.innerText="Pause";
  score=0; lives=3;
  obstacle.x=900; obstacle.passed=false;
  bubble.x=1400; bubble.collected=false;
  player.y = playerOnGrassY();
  setObstacleSpeed();
  obstacle.y = playerOnGrassY() + player.height - obstacle.h;
  fireworks = [];
  requestAnimationFrame(loop);
}

// Difficulty speeds
function setObstacleSpeed(){
  switch(difficulty){
    case "easy": obstacle.speed = 3 + Math.random()*2; break;
    case "medium": obstacle.speed = 5 + Math.random()*2; break;
    case "hard": obstacle.speed = 7 + Math.random()*3; break;
  }
}

function playerOnGrassY(){ return 350 - player.height; }

// Draw functions
function drawBackground(){
  ctx.fillStyle="#6ec6ff"; ctx.fillRect(0,0,900,450);
  ctx.fillStyle="#4caf50"; ctx.fillRect(0,350,900,100); // grass
  ctx.fillStyle="#8B4513"; ctx.fillRect(0,390,900,60); // dirt

  // Clouds
  ctx.fillStyle="white";
  ctx.beginPath(); ctx.arc(150,100,30,0,Math.PI*2); ctx.arc(180,100,40,0,Math.PI*2);
  ctx.arc(210,100,30,0,Math.PI*2); ctx.fill();

  ctx.beginPath(); ctx.arc(650,80,20,0,Math.PI*2); ctx.arc(670,80,30,0,Math.PI*2);
  ctx.arc(700,80,20,0,Math.PI*2); ctx.fill();

  // Rainbow
  const rainbowColors=["red","orange","yellow","green","blue","purple"];
  rainbowColors.forEach((color,i)=>{
    ctx.beginPath();
    ctx.strokeStyle=color;
    ctx.lineWidth=8;
    ctx.arc(450,350,100-i*8,Math.PI,2*Math.PI);
    ctx.stroke();
  });
}

function drawPlayer(){
  const x=player.x, y=player.y;
  ctx.strokeStyle="#000"; ctx.lineWidth=3;
  ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x,y-30); ctx.stroke(); // body
  ctx.beginPath(); ctx.moveTo(x,y-20); ctx.lineTo(x-10,y-10); ctx.moveTo(x,y-20); ctx.lineTo(x+10,y-10); ctx.stroke(); // arms
  ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x-10,y+20); ctx.moveTo(x,y); ctx.lineTo(x+10,y+20); ctx.stroke(); // legs
  ctx.beginPath(); ctx.arc(x,y-40,8,0,Math.PI*2); ctx.stroke(); // head
}

function drawLives(){
  for(let i=0;i<lives;i++){
    ctx.fillStyle="red"; ctx.beginPath(); ctx.arc(25+i*30,25,7,0,Math.PI*2); ctx.arc(33+i*30,25,7,0,Math.PI*2); ctx.fill();
  }
}

function createFirework(){
  let x=Math.random()*800+50, y=Math.random()*200+50;
  const colors=["red","orange","yellow","green","blue","purple"];
  for(let i=0;i<20;i++){
    fireworks.push({x:x,y:y,dx:(Math.random()-0.5)*6,dy:(Math.random()-0.5)*6,color:colors[Math.floor(Math.random()*colors.length)],life:60});
  }
}

function drawFireworks(){
  fireworks.forEach(f=>{ ctx.fillStyle=f.color; ctx.beginPath(); ctx.arc(f.x,f.y,3,0,Math.PI*2); ctx.fill(); f.x+=f.dx; f.y+=f.dy; f.life--; });
  fireworks = fireworks.filter(f=>f.life>0 && score<5200); // disappears after 5200
}

function gameOver(){
  gameRunning=false;
  retryBtn.style.display="block";
  if(score>highScore){localStorage.setItem('heartBoundHigh',score);}
  highScore = Math.max(score, highScore);
  highScoreDiv.innerText = "High Score: " + highScore;
  ctx.fillStyle="black"; ctx.font="60px Arial"; ctx.fillText("GAME OVER",280,200);
}

// Main loop
function loop(){
  if(!gameRunning || paused) return;
  ctx.clearRect(0,0,900,450);
  drawBackground();

  // Player gravity
  player.vy+=0.8; player.y+=player.vy;
  if(player.y>=playerOnGrassY()){player.y=playerOnGrassY(); player.vy=0; player.jumping=false;}

  // Obstacle movement
  obstacle.x-=obstacle.speed;
  if(obstacle.x<-50){obstacle.x=900; obstacle.passed=false; setObstacleSpeed();}
  if(!obstacle.passed && obstacle.x<player.x){score+=100; obstacle.passed=true;}

  // Collision
  if(player.x+5>obstacle.x && player.x-5<obstacle.x+obstacle.w && player.y+player.height>obstacle.y){
    lives--; obstacle.x=900;
    if(lives<=0) return gameOver();
  }

  // Bubble
  bubble.x-=3;
  ctx.strokeStyle="white"; ctx.beginPath(); ctx.arc(bubble.x,bubble.y,bubble.r,0,Math.PI*2); ctx.stroke();
  ctx.fillStyle="black"; ctx.font="12px Arial"; ctx.fillText("+50",bubble.x-12,bubble.y+5);
  if(!bubble.collected && player.y+player.height>bubble.y-bubble.r && player.y<bubble.y+bubble.r && Math.abs(player.x-bubble.x)<20 && player.vy<0){
    score+=50; bubble.collected=true; bubble.x=1400;
  }

  // Draw
  drawPlayer();
  ctx.fillStyle="#4caf50"; ctx.fillRect(obstacle.x,obstacle.y,obstacle.w,15);
  ctx.fillStyle="#8B4513"; ctx.fillRect(obstacle.x,obstacle.y+15,obstacle.w,obstacle.h-15);
  drawLives();
  ctx.fillStyle="black"; ctx.font="20px Arial"; ctx.fillText("Score: "+score,760,30);

  // Fireworks at 5000 points
  if(score>=5000 && score<5200){createFirework();}
  drawFireworks();

  requestAnimationFrame(loop);
}

</script>
</body>
</html>
